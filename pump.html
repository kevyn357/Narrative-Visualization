
<html>
  <script src='https://d3js.org/d3.v5.min.js'></script>
  <script src='https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js'></script>
  <style> circle {fill: lightblue; stroke: black;}</style>
  <style> ellipse {fill: green; stroke: black;}</style>
  <!-- <body onload='init()'> -->

  <!-- https://bl.ocks.org/d3noob/a22c42db65eb00d4e369 -->
  <style>
     div.tooltip
    {
      position: absolute;
      text-align: center;
      width:120px; height:60px;
      background: lightsteelblue;
     border:0px;
     border-radius: 8px;
     pointer-events: none;
    }
    </style>

  
    <svg width=1920 height=550> </svg>

    <button type="button" onclick="window.location.href='https://kevyn357.github.io/Narrative-Visualization/index.html';"> Scene 1: Gas Prices VS Crude Prices </button>
  <button type="button" onclick="window.location.href='https://kevyn357.github.io/Narrative-Visualization/pump.html';"> Scene 2: US domestic events with Gas and Crude Prices</button>
  <button type="button" onclick="window.location.href='https://kevyn357.github.io/Narrative-Visualization/combined.html';"> Scene 3: World Events with Gas and Crude Prices</button>
  <button type="button" onclick="window.location.href='https://kevyn357.github.io/Narrative-Visualization/combined.html';"> Next </button>
<br>
  <label for="pres">Presidential Elections:</label> 
  <input type="checkbox" id="pres" checked="checked" onclick="makePres()">

  <label for="pres">Midterm Elections:</label> 
  <input type="checkbox" id="midterm" onclick="makeMidterm()">
<br>
  <script>
    var fmt1 = d3.timeParse("%b-%Y");
          console.log(fmt1("Jan-2000"));

          var fmt2 = d3.timeParse("%e-%b-%y");
    var fmt3 = d3.timeParse("%e-%b-%Y");
    var formatTimeC = d3.timeFormat("%b-%Y");
    var formatTimeP = d3.timeFormat("%e-%b-%y");
          console.log(fmt3("24-Feb-2022"));

          var x = d3.scaleTime().domain([new Date(2000,01,01), new Date(2022,12,31)]).range([0,1500]);
          var yCrude = d3.scaleLinear().domain([0, 150]).range([425,0]);
    var yPump = d3.scaleLinear().domain([0, 5.2]).range([425,0]);

    
    function makePres()
          {
              var presCheck = document.getElementById("pres");
              if(pres.checked)
              {
                  

                  d3.select("svg").append("line")
                  .attr("x1", x(fmt3("7-Nov-2000")))
                  .attr("y1", 600)
                  .attr("x2", x(fmt3("7-Nov-2000")))
                  .attr("y2", 0)
                  .attr("stroke-width", 1)
                  .attr("id", "gw1")
                  .attr("stroke", "red");

                  d3.select("svg").append("line")
                  .attr("x1", x(fmt3("2-Nov-2004")))
                  .attr("y1", 600)
                  .attr("x2", x(fmt3("2-Nov-2004")))
                  .attr("y2", 0)
                  .attr("stroke-width", 1)
                  .attr("id", "gw2")
                  .attr("stroke", "red");

                   d3.select("svg").append("line")
                   .attr("x1", x(fmt3("4-Nov-2008")))
                   .attr("y1", 600)
                   .attr("x2", x(fmt3("4-Nov-2008")))
                   .attr("y2", 0)
                   .attr("stroke-width", 1)
                   .attr("id", "bo1")
                   .attr("stroke", "blue");

                   d3.select("svg").append("line")
                   .attr("x1", x(fmt3("6-Nov-2012")))
                   .attr("y1", 600)
                   .attr("x2", x(fmt3("6-Nov-2012")))
                   .attr("y2", 0)
                   .attr("stroke-width", 1)
                   .attr("id", "bo2")
                   .attr("stroke", "blue");

                   d3.select("svg").append("line")
                   .attr("x1", x(fmt3("8-Nov-2016")))
                   .attr("y1", 600)
                   .attr("x2", x(fmt3("8-Nov-2016")))
                   .attr("y2", 0)
                   .attr("stroke-width", 1)
                   .attr("id", "djt")
                   .attr("stroke", "red");

                   d3.select("svg").append("line")
                   .attr("x1", x(fmt3("3-Nov-2020")))
                   .attr("y1", 600)
                   .attr("x2", x(fmt3("3-Nov-2020")))
                   .attr("y2", 0)
                   .attr("stroke-width", 1)
                   .attr("id", "jb")
                   .attr("stroke", "blue");
              }
              else
              {
                  d3.select("#gw1").remove();
                  d3.select("#gw2").remove();
                  d3.select("#bo1").remove();
                  d3.select("#bo2").remove();
                  d3.select("#djt").remove();
                  d3.select("#jb").remove();
              }
    }
    makePres();
    function makeMidterm()
          {
              var midCheck = document.getElementById("midterm");
              if(midterm.checked)
              {
                  

                  d3.select("svg").append("line")
                  .attr("x1", x(fmt3("5-Nov-2002")))
                  .attr("y1", 600)
                  .attr("x2", x(fmt3("5-Nov-2002")))
                  .attr("y2", 0)
                  .attr("stroke-width", 1)
                  .attr("id", "m02")
                  .attr("stroke", "red");

                  d3.select("svg").append("line")
                  .attr("x1", x(fmt3("7-Nov-2006")))
                  .attr("y1", 600)
                  .attr("x2", x(fmt3("7-Nov-2006")))
                  .attr("y2", 0)
                  .attr("stroke-width", 1)
                  .attr("id", "m06")
                  .attr("stroke", "blue");

                   d3.select("svg").append("line")
                   .attr("x1", x(fmt3("2-Nov-2010")))
                   .attr("y1", 600)
                   .attr("x2", x(fmt3("2-Nov-2010")))
                   .attr("y2", 0)
                   .attr("stroke-width", 1)
                   .attr("id", "m10")
                   .attr("stroke", "purple");

                   d3.select("svg").append("line")
                   .attr("x1", x(fmt3("4-Nov-2014")))
                   .attr("y1", 600)
                   .attr("x2", x(fmt3("4-Nov-2014")))
                   .attr("y2", 0)
                   .attr("stroke-width", 1)
                   .attr("id", "m14")
                   .attr("stroke", "red");

                   d3.select("svg").append("line")
                   .attr("x1", x(fmt3("6-Nov-2018")))
                   .attr("y1", 600)
                   .attr("x2", x(fmt3("6-Nov-2018")))
                   .attr("y2", 0)
                   .attr("stroke-width", 1)
                   .attr("id", "m18")
                   .attr("stroke", "purple");

              }
              else
              {
                  d3.select("#m02").remove();
                  d3.select("#m06").remove();
                  d3.select("#m10").remove();
                  d3.select("#m14").remove();
                  d3.select("#m18").remove();
              }
          }
      async function init()
      {
          const dataCrude = await d3.csv('crude.csv');
          console.log(dataCrude);
          const dataPump = await d3.csv('usPump.csv');
          console.log(dataPump);

          //var xTool = d3.scaleLinear().domain().range();
      
          

          //https://stackoverflow.com/questions/29910194/d3-js-vertical-line-on-a-time-axis
          //https://stackoverflow.com/questions/34455345/d3-js-appendline-doesnt-show-up

         

    var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity",0);

      d3.select('svg').append("g").attr("transform", "translate("+50+","+50+")")
      .selectAll("circle")
      .data(dataCrude)
      .enter()
      .append("circle")
      .attr("cx", function(d,i){return x(fmt1(d.Date));})
      .attr("cy", function(d,i){return yCrude(d.USCrude);})
      .attr("r", 2)
      .on("mouseover", function(d,i)
      {
          div.transition().duration(200).style("opacity",1)
          div.style("left", (d3.event.pageX)+"px")
          .style("top", (d3.event.pageY)+"px")
          .html(formatTimeC(fmt1(d.Date)) + "<br/>" + "Crude Price: " + d.USCrude);
      }).on("mouseout", function(d) {div.transition().duration(500).style("opacity",0)})
      ;

       d3.select('svg').append("g").attr("transform", "translate("+50+","+50+")")
      .selectAll("ellipse")
      .data(dataPump)
      .enter()
      .append("ellipse")
      .attr("cx", function(d,i){return x(fmt2(d.Date));})
      .attr("cy", function(d,i){return yPump(d.USRetail);})
      .attr("rx", 2)
    .attr("ry", 2)
    .on("mouseover", function(d,i)
      {
          div.transition().duration(200).style("opacity",1)
          div.style("left", (d3.event.pageX)+"px")
          .style("top", (d3.event.pageY)+"px")
          .html(formatTimeP(fmt2(d.Date)) + "<br/>" + "Gasoline Price: " + d.USRetail);
      }).on("mouseout", function(d) {div.transition().duration(500).style("opacity",0)})
      ;

      d3.select("svg").append("g").attr("transform", "translate("+50+","+50+")")
      .attr("fill", "none")
      .call(d3.axisLeft(yCrude)
      );

      d3.select("svg").append("g").attr("transform", "translate("+1550+","+50+")")
      .attr("fill", "none")
      .call(d3.axisRight(yPump)
      );

      const xAxis = d3.axisBottom(x).ticks(24).tickFormat(d3.timeFormat("%b-%Y"));
      d3.select("svg").append("g").attr("transform", "translate("+50+","+475+")")
      .call(xAxis)
      .selectAll("text") 
      .style("text-anchor", "end")
      .attr("dx", "-.5em")
      .attr("dy", "-.1em")
      .attr("transform", "rotate(-70)")
    ;

    

      //http://www.d3noob.org/2013/01/adding-title-to-your-d3js-graph.html
      d3.select("svg").append("text")
        .attr("x", 800)             
        .attr("y", 20)
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-decoration", "underline")  
      .text("US Domestic Events with Average Crude Oil and Gasoline Prices in USA");

      d3.select("svg").append("text")
      .attr("transform", "rotate(-90)")
   .attr("x", -250)
   .attr("y", 15)
   .style("text-anchor", "middle")
   .text("Crude Oil Price USD/Barrel");

      d3.select("svg").append("text")
      .attr("transform", "rotate(90)")
   .attr("x", 275)
   .attr("y", -1600)
   .style("text-anchor", "middle")
      .text("Gasoline Price USD/Gallon");

      d3.select("svg").append("text")
   .attr("x", 800)
   .attr("y", 550)
   .style("text-anchor", "middle")
   .text("Date");
      }

      
      
      //https://bl.ocks.org/susielu/a464c24d8b42f0c4d9fafe7b48e9e60a
      const annotations = [
        {
          type: d3.annotationCalloutCircle,
          note: {
            label: "The US was hit by a major terrorist attack on 9/11/2001.",
            title: "September 11th attacks",
            wrap: 190
          },
          //settings for the subject, in this case the circle radius
          subject: {
            radius: 45
          },
          x: 150,
          y: 400,
          dy: -180,
          dx: 180
          },{
          //below in makeAnnotations has type set to d3.annotationLabel
          //you can add this type value below to override that default
          type: d3.annotationCalloutCircle,
          note: {
            label: "Subprime lending during the 21st century caused a burst of the real estate bubble, causing a global recession.",
            title: "Financial Crisis of 2007-2008",
            wrap: 190
          },
          //settings for the subject, in this case the circle radius
          subject: {
            radius: 40
          },
          x: 600,
          y: 120,
          dy: 150,
          dx: 150
        }].map(function(d){ d.color = "#E8336D"; return d})
      
      const makeAnnotations = d3.annotation()
          .type(d3.annotationLabel)
          .annotations(annotations)

        d3.select("svg")
          .append("g")
          .attr("class", "annotation-group")
    .call(makeAnnotations)


    


    
  </script>
  <br>
  <b>Key:</b> The <span style="color:green;"> green </span> dots represent average US gasoline prices measured 4 times a month with the scale on the right axis.
  <br>
  The <span style="color:blue;"> blue </span> dots represent average US crude oil prices measured once a month the scale on the left axis.
  <br>
  <br>
  You can mouse over each dot to see a tooltip for the exact date and price.
  <br>
  The checkboxes enable and disable lines for US elections. The first checkbox is for enabling presidential elections and the second is for enabling midterm elections. Blue is for a democratic victory, red is for a republican victory, and purple is for different parties winning the senate and house.
  <br>
  Navigate between the scenes using the labeled buttons.

  <body onload='init()'>
    </body>
    <!-- </body> -->
  </html>
